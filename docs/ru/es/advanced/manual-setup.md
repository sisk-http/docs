# Ручная настройка (продвинутая)

В этом разделе мы создадим наш сервер HTTP без использования каких-либо предварительно определенных стандартов, совершенно абстрактным способом. Здесь вы можете вручную настроить, как будет работать ваш сервер HTTP. Каждый ListeningHost имеет маршрутизатор, и сервер HTTP может иметь несколько ListeningHosts, каждый из которых указывает на разный хост на разном порту.

Сначала нам нужно понять концепцию запрос/ответ. Это довольно просто: на каждый запрос должен быть ответ. Sisk также следует этому принципу. Мы создаем метод, который отвечает сообщением "Привет, мир!" в HTML, указывая код состояния и заголовки.

```csharp
// Program.cs
using Sisk.Core.Http;
using Sisk.Core.Routing;

static HttpResponse IndexPage(HttpRequest request)
{
    HttpResponse indexResponse = new HttpResponse
    {
        Status = System.Net.HttpStatusCode.OK,
        Content = new HtmlContent(@"
            <html>
                <body>
                    <h1>Привет, мир!</h1>
                </body>
            </html>
        ")
    };

    return indexResponse;
}
```

Следующий шаг - связать этот метод с маршрутом HTTP.

## Маршрутизаторы

Маршрутизаторы являются абстракциями маршрутов запросов и служат мостом между запросами и ответами для службы. Маршрутизаторы управляют маршрутами службы, функциями и ошибками.

Маршрутизатор может иметь несколько маршрутов, и каждый маршрут может выполнять различные операции на этом маршруте, такие как выполнение функции, обслуживание страницы или предоставление ресурса с сервера.

Мы создаем наш первый маршрутизатор и связываем наш метод `IndexPage` с маршрутом индекса.

```csharp
Router mainRouter = new Router();

// SetRoute связывает все маршруты индекса с нашим методом.
mainRouter.SetRoute(RouteMethod.Get, "/", IndexPage);
```

Теперь наш маршрутизатор может получать запросы и отправлять ответы. Однако `mainRouter` не связан с хостом или сервером, поэтому он не будет работать самостоятельно. Следующий шаг - создать наш ListeningHost.

## Хосты и порты прослушивания

ListeningHost может размещать маршрутизатор и несколько портов прослушивания для одного и того же маршрутизатора. ListeningPort является префиксом, где сервер HTTP будет прослушивать.

Здесь мы можем создать ListeningHost, который указывает на два конца для нашего маршрутизатора:

```csharp
ListeningHost myHost = new ListeningHost
{
    Router = new Router(),
    Ports = new ListeningPort[]
    {
        new ListeningPort("http://localhost:5000/")
    }
};
```

Теперь наш сервер HTTP будет прослушивать указанные концы и перенаправлять свои запросы на наш маршрутизатор.

## Настройка сервера

Настройка сервера отвечает за большинство поведения сервера HTTP сам по себе. В этой настройке мы можем связать ListeningHosts с нашим сервером.

```csharp
HttpServerConfiguration config = new HttpServerConfiguration();
config.ListeningHosts.Add(myHost); // Добавьте наш ListeningHost в эту настройку сервера
```

Далее мы можем создать наш сервер HTTP:

```csharp
HttpServer server = new HttpServer(config);
server.Start();    // Запускает сервер
Console.ReadKey(); // Предотвращает закрытие приложения
```

Теперь мы можем скомпилировать наш исполняемый файл и запустить наш сервер HTTP с помощью команды:

```bash
dotnet watch
```

В время выполнения откройте свой браузер и перейдите по маршруту сервера, и вы должны увидеть:

<img src="/assets/img/localhost.png" >
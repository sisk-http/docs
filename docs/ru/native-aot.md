# Поддержка Native AOT

В .NET 7 была введена [Native AOT](https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/), режим компиляции .NET, который позволяет экспортировать готовые двоичные файлы на любую поддерживаемую платформу без необходимости установки среды выполнения .NET на целевой машине.

С Native AOT ваш код компилируется в нативный код и уже содержит все необходимое для его выполнения. Sisk экспериментировал с этой функцией с версии 0.9.1, которая улучшает поддержку Native AOT с функциями для определения динамических маршрутов приложением без влияния на компиляцию с предупреждениями.

Sisk использует Reflection для получения методов, которые будут определены из типов и объектов. Кроме того, Sisk использует Reflection для атрибутов, таких как `RequestHandlerAttribute`, которые инициализируются из типа. Для правильной работы компиляции AOT используется тримирование, при котором должны быть указаны динамические типы, которые будут использоваться в конечном сборке.

Рассмотрим пример ниже, это маршрут, который вызывает RequestHandler.

```cs
[Route(RouteMethod.Get, "/", LogMode = LogOutput.None)]
[RequestHandler(typeof(MyRequestHandler))]
static HttpResponse IndexPage(HttpRequest request)
{
    HttpResponse htmlResponse = new HttpResponse();
    htmlResponse.Content = new StringContent("Hello, world!", System.Text.Encoding.UTF8, "text/plain");
    return htmlResponse;
}
```

Этот RequestHandler динамически вызывается во время выполнения, и этот вызов должен быть сегментирован, и эта сегментация должна быть явной.

Чтобы лучше понять, что компилятор будет учитывать из `MyRequestHandler` должно быть сохранено в конечной компиляции, вот:

- Публичные свойства;
- Публичные и приватные поля;
- Публичные и приватные конструкторы;
- Публичные и приватные методы;

Все, что у вас есть в RequestHandler, что не указано выше, будет удалено компилятором.

Помните, что все остальные компоненты, классы и пакеты, которые вы используете в своем приложении, должны быть совместимы с AOT Trimming, иначе ваш код может работать не так, как ожидалось. Кстати, Sisk не оставит вас, если вы хотите построить что-то, где производительность является приоритетом.

Вы можете прочитать больше о Native AOT и о том, как она работает, в официальной [документации Microsoft](https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/).

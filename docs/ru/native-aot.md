# Поддержка Native AOT

В .NET 7 была введена [Native AOT](https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/), режим компиляции .NET, который позволяет экспортировать готовые бинарные файлы на любой поддерживаемой платформе, без необходимости установки среды выполнения .NET на целевой машине.

С помощью Native AOT ваш код компилируется в родной код и уже содержит все необходимое для его выполнения. Sisk экспериментирует с этой функцией с версии 0.9.1, которая улучшает поддержку Native AOT с функциями определения динамических маршрутов по приложению без влияния на компиляцию предупреждающими сообщениями.

Sisk использует рефлексию для получения методов, которые будут определены из типов и объектов. Кроме того, Sisk использует рефлексию для атрибутов, таких как `RequestHandlerAttribute`, которые инициализируются из типа. Для правильной работы компиляции AOT используется обрезка, где динамические типы должны быть указаны, что будет использовано в окончательном сборке.

Рассмотрим пример ниже, это маршрут, который вызывает RequestHandler.

```cs
[Route(RouteMethod.Get, "/", LogMode = LogOutput.None)]
[RequestHandler(typeof(MyRequestHandler))]
static HttpResponse IndexPage(HttpRequest request)
{
    HttpResponse htmlResponse = new HttpResponse();
    htmlResponse.Content = new StringContent("Hello, world!", System.Text.Encoding.UTF8, "text/plain");
    return htmlResponse;
}
```

Этот RequestHandler динамически вызывается во время выполнения, и этот вызов должен быть разделен, и это разделение должно быть явным.

Чтобы лучше понять, что компилятор будет учитывать из `MyRequestHandler`, должно быть сохранено в окончательной компиляции:

- Публичные свойства;
- Публичные и приватные поля;
- Публичные и приватные конструкторы;
- Публичные и приватные методы;

Все, что у вас есть в RequestHandler, что не упоминается выше, будет удалено компилятором.

Помните, что все остальные компоненты, классы и пакеты, которые вы используете в своем приложении, должны быть совместимы с AOT Trimming, или ваш код не будет работать так, как ожидается. Тем не менее, Sisk не оставит вас, если вы хотите построить что-то, где производительность является приоритетом.

Вы можете прочитать больше о Native AOT и том, как она работает в официальной [документации Microsoft](https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/).
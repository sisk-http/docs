# Руководство (расширенная) настройка

В этом разделе мы создадим наш HTTP-сервер без каких-либо предопределенных стандартов, совершенно абстрактным способом. Здесь вы можете вручную настроить, как будет функционировать ваш HTTP-сервер. Каждый ListeningHost имеет маршрутизатор, и HTTP-сервер может иметь несколько ListeningHosts, каждый из которых указывает на другой хост на другом порту.

Сначала нам нужно понять концепцию запроса/ответа. Это довольно просто: на каждый запрос должен быть ответ. Sisk также следует этому принципу. Давайте создадим метод, который отвечает сообщением "Hello, World!" в HTML, указывая статусный код и заголовки.

```csharp
// Program.cs
using Sisk.Core.Http;
using Sisk.Core.Routing;

static HttpResponse IndexPage(HttpRequest request)
{
    HttpResponse indexResponse = new HttpResponse
    {
        Status = System.Net.HttpStatusCode.OK,
        Content = new HtmlContent(@"
            <html>
                <body>
                    <h1>Привет, мир!</h1>
                </body>
            </html>
        ")
    };

    return indexResponse;
}
```

Следующий шаг - связать этот метод с HTTP-маршрутом.

## Маршрутизаторы

Маршрутизаторы являются абстракциями запросов и служат мостом между запросами и ответами для службы. Маршрутизаторы управляют маршрутами службы, функциями и ошибками.

Маршрутизатор может иметь несколько маршрутов, и каждый маршрут может выполнять разные операции на этом пути, такие как выполнение функции, служба страницы или предоставление ресурса с сервера.

Давайте создадим наш первый маршрутизатор и свяжем наш метод `IndexPage` с индексным путем.

```csharp
Router mainRouter = new Router();

// SetRoute будет связывать все индексные маршруты с нашим методом.
mainRouter.SetRoute(RouteMethod.Get, "/", IndexPage);
```

Теперь наш маршрутизатор может получать запросы и отправлять ответы. Однако `mainRouter` не привязан к хосту или серверу, поэтому он не будет работать самостоятельно. Следующий шаг - создать наш ListeningHost.

## Listening Hosts и Порты

ListeningHost может хостить маршрутизатор и несколько прослушиваемых портов для одного и того же маршрутизатора. ListeningPort - это префикс, где HTTP-сервер будет слушать.

Здесь мы можем создать `ListeningHost`, который указывает на два端пойнта для нашего маршрутизатора:

```csharp
ListeningHost myHost = new ListeningHost
{
    Router = new Router(),
    Ports = new ListeningPort[]
    {
        new ListeningPort("http://localhost:5000/")
    }
};
```

Теперь наш HTTP-сервер будет слушать указанные端пойнты и перенаправлять свои запросы на наш маршрутизатор.

## Настройка Сервера

Настройка сервера отвечает за большую часть поведения HTTP-сервера. В этой конфигурации мы можем связать `ListeningHosts` с нашим сервером.

```csharp
HttpServerConfiguration config = new HttpServerConfiguration();
config.ListeningHosts.Add(myHost); // Добавляем наш ListeningHost в эту конфигурацию сервера
```

Далее мы можем создать наш HTTP-сервер:

```csharp
HttpServer server = new HttpServer(config);
server.Start();    // Запускает сервер
Console.ReadKey(); // Предотвращает выход из приложения
```

Теперь мы можем скомпилировать наш исполняемый файл и запустить наш HTTP-сервер с командой:

```bash
dotnet watch
```

Во время выполнения откройте браузер и перейдите по пути сервера, и вы должны увидеть:

<img src="/assets/img/localhost.png" >
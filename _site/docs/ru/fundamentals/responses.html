<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title> | Sisk Framework </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="title" content=" | Sisk Framework ">


        <link rel="icon" href="../../../assets/img/favicon.ico">
        <link rel="stylesheet" href="../../../public/docfx.min.css">
        <link rel="stylesheet" href="../../../public/main.css">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
        <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

        <meta name="docfx:navrel" content="../../../toc.html">
        <meta name="docfx:tocrel" content="../toc.html">

        <meta name="docfx:rel" content="../../../">


        <meta name="docfx:docurl" content="https://github.com/sisk-http/docs/blob/master/docs/ru/fundamentals/responses.md/#L1">
        <meta name="loc:inThisArticle" content="In this article">
        <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
        <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
        <meta name="loc:tocFilter" content="Filter by title">
        <meta name="loc:nextArticle" content="Next">
        <meta name="loc:prevArticle" content="Previous">
        <meta name="loc:themeLight" content="Light">
        <meta name="loc:themeDark" content="Dark">
        <meta name="loc:themeAuto" content="Auto">
        <meta name="loc:changeTheme" content="Change theme">
        <meta name="loc:copy" content="Copy">
        <meta name="loc:downloadPdf" content="Download PDF">
        
        <script type="module" src="./../../../public/docfx.min.js"></script>
        <script>
            const theme = localStorage.getItem('theme') || 'auto';
            document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
        </script>
        
        <script src="https://unpkg.com/@cypherpotato/el/dist/el.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll("pre").forEach(pre => {
                    const lineCount = pre.innerText.split('\n').length;
                    const lis = [];
                    
                    for(var i = 1; i < lineCount; i++)
                        lis.push(el("li", i))
                    
                    pre.appendChild(el("ul", ...lis));
                });
            });
        </script>
        
        <!-- Cloudflare Web Analytics -->
        <script defer="" src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "e1483f9ff9e246f4bd69e45a87ef6923"}'></script>
        <!-- End Cloudflare Web Analytics -->

        <script>

            function switchLanguage(lang) {
                const docPart = window.location.pathname.match(/\/docs\/((pt\-br|ru|cn)\/)?(.*)/)[3];
                const newPath = lang + docPart;
                window.location.href = window.location.origin + newPath;
            }
        
        </script>

    </head>


    <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
        <header class="bg-body border-bottom">
            <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
                <div class="container-xxl flex-nowrap">
                    <a class="navbar-brand" href="../../../index.html">
                        <img id="logo" class="svg" src="../../../assets/img/Icon.png" alt="Sisk Framework">
                        Sisk Framework
                    </a>
                    <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <div class="collapse navbar-collapse" id="navpanel">
                        <div id="navbar">
                            <form class="search" role="search" id="search">
                                <i class="bi bi-search"></i>
                                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
                            </form>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <main class="container-xxl">
            <div class="toc-offcanvas">
                <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <nav class="toc" id="toc"></nav>
                    </div>
                </div>
            </div>

            <div class="content">
                <div class="actionbar">
                    <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
                        <i class="bi bi-list"></i>
                    </button>

                    <nav id="breadcrumb"></nav>

                    <div id="language-wrapper">
                        <a class="btn border-0 dropdown-toggle show" data-bs-toggle="dropdown" aria-expanded="true" title="Change theme">
                            <i class="bi bi-globe"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end language-dropdown">
                            <li>
                                <a class="dropdown-item" href="javascript:switchLanguage('/docs/')">
                                    <img src="/assets/flag/usa.png">
                                    English
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="javascript:switchLanguage('/docs/ru/')">
                                    <img src="/assets/flag/russia.png">
                                    Русский
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="javascript:switchLanguage('/docs/cn/')">
                                    <img src="/assets/flag/china.png">
                                    汉语
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="javascript:switchLanguage('/docs/pt-br/')">
                                    <img src="/assets/flag/brazil.png">
                                    Português
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <article data-uid="">

<p>От Responses представляют собой объекты HTTP-ответов на HTTP-запросы. Они отправляются сервером клиенту в качестве указания на запрос ресурса, страницы, документа, файла или другого объекта.</p>
<p>HTTP-ответ состоит из статуса, заголовков и содержимого.</p>
<p>В этом документе мы научим вас, как архитектурировать HTTP-ответы с помощью Sisk.</p>
<h2 id="установка-http-статуса">Установка HTTP-статуса</h2>
<p>Список HTTP-статусов тот же с HTTP/1.0, и Sisk поддерживает все их.</p>
<pre><code class="lang-cs">HttpResponse res = new HttpResponse();
res.Status = System.Net.HttpStatusCode.Accepted; // 202
</code></pre>
<p>Или с помощью флюидной синтаксиса:</p>
<pre><code class="lang-cs">new HttpResponse()
    .WithStatus(200) // или
    .WithStatus(HttpStatusCode.Ok) // или
    .WithStatus(HttpStatusInformation.Ok);
</code></pre>
<p>Полный список доступных кодов HttpStatusCode можно посмотреть <a href="https://learn.microsoft.com/pt-br/dotnet/api/system.net.httpstatuscode">здесь</a>. Вы также можете указать свой собственный код статуса, используя структуру <a href="/api/Sisk.Core.Http.HttpStatusInformation">HttpStatusInformation</a>.</p>
<h2 id="тело-и-content-type">Тело и content-type</h2>
<p>Sisk поддерживает использование встроенных .NET объектов контента для отправки тела в ответах. Вы можете использовать класс <a href="https://learn.microsoft.com/pt-br/dotnet/api/system.net.http.stringcontent">StringContent</a> для отправки JSON-ответа, например:</p>
<pre><code class="lang-cs">HttpResponse res = new HttpResponse();
res.Content = new StringContent(myJson, Encoding.UTF8, &quot;application/json&quot;);
</code></pre>
<p>Сервер всегда будет пытаться рассчитать <code>Content-Length</code> на основе того, что вы определили в контенте, если вы не указали его явно в заголовке. Если сервер не может неявно получить заголовок <code>Content-Length</code> из содержимого ответа, ответ будет отправлен с кодировкой Chunked-Encoding.</p>
<p>Вы также можете передавать ответ по потоку, отправляя <a href="https://learn.microsoft.com/pt-br/dotnet/api/system.net.http.streamcontent">StreamContent</a> или используя метод GetResponseStream.</p>
<h2 id="заголовки-ответа">Заголовки ответа</h2>
<p>Вы можете добавлять, изменять или удалять заголовки, которые вы отправляете в ответе. Ниже приведен пример того, как отправить ответ перенаправления клиенту.</p>
<pre><code class="lang-cs">HttpResponse res = new HttpResponse();
res.Status = HttpStatusCode.Moved;
res.Headers.Add(HttpKnownHeaderNames.Location, &quot;/login&quot;);
</code></pre>
<p>Или с помощью флюидной синтаксиса:</p>
<pre><code class="lang-cs">new HttpResponse(301)
    .WithHeader(&quot;Location&quot;, &quot;/login&quot;);
</code></pre>
<p>При использовании метода <a href="/api/Sisk.Core.Entity.HttpHeaderCollection.Add">Add</a> HttpHeaderCollection, вы добавляете заголовок к запросу без изменения уже отправленных заголовков. Метод <a href="/api/Sisk.Core.Entity.HttpHeaderCollection.Set">Set</a> заменяет заголовки с тем же именем на указанное значение. Индексатор HttpHeaderCollection внутренне вызывает метод Set для замены заголовков.</p>
<h2 id="отправка-cookie">Отправка cookie</h2>
<p>Sisk предоставляет методы для упрощения определения cookie в клиенте. Cookie, установленные с помощью этого метода, уже закодированы URL и соответствуют стандарту RFC-6265.</p>
<pre><code class="lang-cs">HttpResponse res = new HttpResponse();
res.SetCookie(&quot;cookie-name&quot;, &quot;cookie-value&quot;);
</code></pre>
<p>Или с помощью флюидной синтаксиса:</p>
<pre><code class="lang-cs">new HttpResponse(301)
    .WithCookie(&quot;cookie-name&quot;, &quot;cookie-value&quot;, expiresAt: DateTime.Now.Add(TimeSpan.FromDays(7)));
</code></pre>
<p>Существуют другие <a href="/api/Sisk.Core.Http.CookieHelper.SetCookie">более полные версии</a> этого метода.</p>
<h2 id="chunked-ответы">Chunked ответы</h2>
<p>Вы можете установить кодировку передачи на chunked для отправки больших ответов.</p>
<pre><code class="lang-cs">HttpResponse res = new HttpResponse();
res.SendChunked = true;
</code></pre>
<p>При использовании chunked-encoding заголовок <code>Content-Length</code> автоматически опускается.</p>
<h2 id="поток-ответа">Поток ответа</h2>
<p>Потоки ответов - это управляемый способ отправки ответов по частям. Это более низкоуровневая операция, чем использование объектов HttpResponse, так как они требуют от вас отправки заголовков и содержимого вручную, а затем закрытия соединения.</p>
<p>Этот пример открывает для чтения поток файла, копирует поток в поток выходных данных ответа и не загружает весь файл в память. Это может быть полезно для обслуживания средних или больших файлов.</p>
<pre><code class="lang-cs">// получает поток выходных данных ответа
using var fileStream = File.OpenRead(&quot;my-big-file.zip&quot;);
var responseStream = request.GetResponseStream();

// устанавливает кодировку ответа на chunked-encoding
// также не следует отправлять заголовок Content-Length при использовании
// chunked-encoding
responseStream.SendChunked = true;
responseStream.SetStatus(200);
responseStream.SetHeader(HttpKnownHeaderNames.ContentType, contentType);

// копирует поток файла в поток выходных данных ответа
fileStream.CopyTo(responseStream.ResponseStream);

// закрывает поток
return responseStream.Close();
</code></pre>
<h2 id="сжатие-gzip-deflate-и-brotli">Сжатие GZip, Deflate и Brotli</h2>
<p>Вы можете отправлять ответы с сжатым содержимым в Sisk с помощью сжатия HTTP-контента. Сначала оберните свой объект <a href="https://learn.microsoft.com/en-us/dotnet/api/system.net.http.httpcontent">HttpContent</a> в один из компрессоров ниже, чтобы отправить сжатый ответ клиенту.</p>
<pre><code class="lang-cs">router.MapGet(&quot;/hello.html&quot;, request =&gt; {
    string myHtml = &quot;...&quot;;
    
    return new HttpResponse () {
        Content = new GZipContent(new HtmlContent(myHtml)),
        // или Content = new BrotliContent(new HtmlContent(myHtml)),
        // или Content = new DeflateContent(new HtmlContent(myHtml)),
    };
});
</code></pre>
<p>Вы также можете использовать эти сжатые контенты с потоками.</p>
<pre><code class="lang-cs">router.MapGet(&quot;/archive.zip&quot;, request =&gt; {
    
    // не применяйте &quot;using&quot; здесь. HttpServer будет discard your content
    // после отправки ответа.
    var archive = File.OpenRead(&quot;/path/to/big-file.zip&quot;);
    
    return new HttpResponse () {
        Content = new GZipContent(archive)
    }
});
</code></pre>
<p>Заголовки <code>Content-Encoding</code> автоматически устанавливаются при использовании этих контентов.</p>
<h2 id="явно-определенные-типы-ответа">Явно определенные типы ответа</h2>
<p>С версии 0.15 вы можете использовать типы возвращаемых значений, отличные от HttpResponse, но необходимо настроить маршрутизатор, как он будет обрабатывать каждый тип объекта.</p>
<p>Суть в том, чтобы всегда возвращать ссылку на тип объекта и преобразовывать его в валидный объект HttpResponse. Маршруты, возвращающие HttpResponse, не подвергаются преобразованию.</p>
<p>Типы значений (структуры) не могут использоваться в качестве типа возвращаемого значения, так как они не совместимы с <a href="/api/Sisk.Core.Routing.RouterCallback">RouterCallback</a>, поэтому их необходимо обернуть в ValueResult, чтобы их можно было использовать в обработчиках.</p>
<p>Рассмотрим следующий пример из модуля маршрутизатора, который не использует HttpResponse в типе возвращаемого значения:</p>
<pre><code class="lang-cs">[RoutePrefix(&quot;/users&quot;)]
public class UsersController : RouterModule
{
    public List&lt;User&gt; Users = new List&lt;User&gt;();

    [RouteGet]
    public IEnumerable&lt;User&gt; Index(HttpRequest request)
    {
        return Users.ToArray();
    }

    [RouteGet(&quot;&lt;id&gt;&quot;)]
    public User View(HttpRequest request)
    {
        int id = request.Query[&quot;id&quot;].GetInteger();
        User dUser = Users.First(u =&gt; u.Id == id);

        return dUser;
    }

    [RoutePost]
    public ValueResult&lt;bool&gt; Create(HttpRequest request)
    {
        User fromBody = JsonSerializer.Deserialize&lt;User&gt;(request.Body)!;
        Users.Add(fromBody);

        return true;
    }
}
</code></pre>
<p>В этом случае необходимо определить в маршрутизаторе, как он будет обрабатывать каждый тип объекта. Объекты всегда являются первым аргументом обработчика, и тип выходного значения должен быть валидным HttpResponse. Также объекты выходных данных маршрута не должны быть null.</p>
<p>Для типов ValueResult не нужно указывать, что входной объект - ValueResult, и только T, так как ValueResult - это объект, отраженный от его исходного компонента.</p>
<p>Сопоставление типов не сравнивает зарегистрированный тип с типом возвращаемого объекта маршрутизатора. Вместо этого оно проверяет, является ли тип результата маршрута присваиваемым зарегистрированному типу.</p>
<p>Регистрация обработчика типа Object будет использоваться в качестве fallback для всех ранее невалидированных типов. Порядок вставки обработчиков значений также имеет значение, поэтому регистрация обработчика Object должна быть последней, так как он будет игнорировать все другие типы, специфичные для значения.</p>
<pre><code class="lang-cs">Router r = new Router();
r.SetObject(new UsersController());

r.RegisterValueHandler&lt;bool&gt;(bolVal =&gt;
{
    HttpResponse res = new HttpResponse();
    res.Status = (bool)bolVal ? HttpStatusCode.OK : HttpStatusCode.BadRequest;
    return res;
});

r.RegisterValueHandler&lt;IEnumerable&gt;(enumerableValue =&gt;
{
    return new HttpResponse();
    // здесь можно сделать что-то с enumerableValue
});

// регистрация обработчика типа object должна быть последней
// и будет использоваться в качестве fallback
r.RegisterValueHandler&lt;object&gt;(fallback =&gt;
{
    HttpResponse res = new HttpResponse();
    res.Status = HttpStatusCode.OK;
    res.Content = JsonContent.Create(fallback);
    return res;
});
</code></pre>

</article>

                <div class="contribution d-print-none">
                    <a href="https://github.com/sisk-http/docs/blob/master/docs/ru/fundamentals/responses.md/#L1" class="edit-link">Edit this page</a>
                </div>

                <div class="next-article d-print-none border-top" id="nextArticle"></div>

            </div>

            <div class="affix">
                <nav id="affix"></nav>
            </div>
        </main>

        <div class="container-xxl search-results" id="search-results"></div>

        <footer class="border-top text-secondary">
            <div class="container-xxl">
                <div class="flex-fill">
                    <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
                </div>
            </div>
            <script>
                if (window.location.pathname.startsWith('/docs/')) {
                    document.getElementById('language-wrapper').style.display = 'block';
                }
            </script>
        </footer>
    </body>
</html>